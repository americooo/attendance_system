{% extends 'attendance/base.html' %}

{% block content %}
<h1 class="text-3xl font-bold mb-6 text-center">ğŸ“ˆ Attendance Report</h1>

<!-- Back button -->
<div class="flex justify-end mb-4">
      <a href="{% url 'download_csv' %}" class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600 mr-2">
        ğŸ’¾ Download CSV
    </a>
  <a href="{% url 'dashboard' %}" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">
    â¬… Back
  </a>
</div>

<!-- Attendance Table -->
<table class="min-w-full bg-white rounded-lg shadow mb-8">
  <thead>
    <tr class="bg-gray-800 text-white">
      <th class="py-3 px-4 text-left">Student</th>
      <th class="py-3 px-4 text-left">Roll No</th>
      <th class="py-3 px-4 text-left">Department</th>
      <th class="py-3 px-4 text-left">Presents</th>
      <th class="py-3 px-4 text-left">Absents</th>
      <th class="py-3 px-4 text-left">Total Classes</th>
      <th class="py-3 px-4 text-left">Status</th>
    </tr>
  </thead>
  <tbody>
    {% for student in report_data %}
    {% if student.total_classes > 0 %}
    <tr class="border-b hover:bg-gray-50">
      <td class="py-3 px-4">{{ student.user.username }}</td>
      <td class="py-3 px-4">{{ student.roll_number }}</td>
      <td class="py-3 px-4">{{ student.department }}</td>
      <td class="py-3 px-4">{{ student.presents }}</td>
      <td class="py-3 px-4">{{ student.absents }}</td>
      <td class="py-3 px-4">{{ student.total_classes }}</td>
      <td class="py-3 px-4">
        {% if student.absents > 3 %}
          <span class="text-red-600 font-semibold">âš  Warning</span>
        {% else %}
          <span class="text-green-600 font-semibold">Good</span>
        {% endif %}
      </td>
    </tr>
    {% endif %}
    {% endfor %}
  </tbody>
</table>

<!-- Attendance Chart -->
<h2 class="text-2xl font-bold mb-4 text-center">ğŸ“Š Attendance Chart</h2>
<div class="flex justify-center mb-6">
  <canvas id="attendanceChart" class="bg-white p-4 rounded-lg shadow-lg max-w-3xl w-full"></canvas>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById('attendanceChart').getContext('2d');
  const students = {{ chart_students|safe }};
  const presents = {{ chart_presents|safe }};
  const absents = {{ chart_absents|safe }};

  const chart = new Chart(ctx, {
      type: 'bar',
      data: {
          labels: students,
          datasets: [
              {
                  label: 'Presents',
                  data: presents,
                  backgroundColor: 'rgba(34, 197, 94, 0.7)',
              },
              {
                  label: 'Absents',
                  data: absents,
                  backgroundColor: 'rgba(239, 68, 68, 0.7)',
              }
          ]
      },
      options: {
          responsive: true,
          plugins: {
              legend: {
                  position: 'top',
              },
              title: {
                  display: true,
                  text: 'Student Attendance Chart'
              }
          }
      }
  });
</script>


{% endblock %}
